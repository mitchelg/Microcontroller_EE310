//-----------------------------
// Title: Heater-Cooler
//-----------------------------
// Purpose: This program checks the temperature of a room and turns on the heater or cooler depending on
// if the measured value is above or below a user-defined temperature.
// Dependencies: AssemblyConfig.inc - Configuration file for PIC18F46K42
// Compiler: pic-as v2.46
// Author: Garry Mitchell
// OUTPUTS: RD1, connected to heater, and RD2, connected to cooler
// INPUTS: NONE
// Versions:
//  	V1.0: 3/7/24 - Project created
//  	V1.1: 3/7/24 - Added hard-coded temp values, added target labels for heating and cooling, revised initialization
//	V1.2: 3/7/24 - Added PORTD initialization, cleaned up code
//	V1.3: 3/7/24 - Added delay loop and "system off" state
//	V1.3.1: 3/13/24 - Added project header
//	V1.3.2: 3/13/24 - Debugging
//-----------------------------

    
//Initialization:
    #include "C:\Users\garre\Desktop\Library\8. School\5. Spring 2024\EE 310\Assignment 6 - Heater Cooler\HeaterCooler.X\AssemblyConfig.inc"
    #include <xc.inc>
    
    PSECT absdata,abs,ovrld
    
    refTemp equ		0x20
    measuredTemp equ	0x21
    contReg equ		0x22
    delayLoop equ	0x50
    REG90 equ		0x90
 

    ORG          0h
    GOTO        _start
    ORG          20h
    
    
 _start:
    BANKSEL	PORTD
    CLRF	PORTD		//Initializing  PORTD
    BANKSEL	ANSELD
    CLRF	ANSELD
    BANKSEL	TRISD
    MOVLW	0b00000000	//Setting up PORTD as output
    MOVWF	TRISD,0
    MOVLW	25	//Values are in decimal, if no type is specified, decimal is assumed by default
    MOVWF	refTemp,0
    MOVLW	2
    MOVWF	measuredTemp,0
    GOTO	_compare

    
_compare:
    MOVF	refTemp,W

    CPFSLT	measuredTemp	    //Skip if F < W, aka measured < ref
    GOTO	_cool	

    CPFSGT	measuredTemp
    GOTO	_heat
    
    GOTO	_off
    
    
_heat:
    MOVLW   2h
    MOVWF   contReg,0
    MOVFF   contReg,PORTD
    GOTO    _delaySet
    
    
_cool:
    MOVLW   4h
    MOVWF   contReg,0
    MOVFF   contReg,PORTD
    GOTO    _delaySet
    
    
_off:
    MOVLW   0h
    MOVWF   contReg,0
    MOVFF   contReg,PORTD
    GOTO    _delaySet
    
    
_delaySet:
    MOVLW   0xFF
    MOVWF   delayLoop
    GOTO    _delayRun

    
_delayRun:
    DECFSZ  delayLoop
    GOTO    _delayRun
    GOTO    _compare

END

